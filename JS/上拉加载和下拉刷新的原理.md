最近在面试，被人问到了上拉加载的原理，好久没弄手机端了，居然刚开始有些卡壳，这里再记录一下巩固知识，顺便连下拉刷新的原理一起记录：

### 1. h5中上拉加载的原理
h5中上拉加载其实和分页是很类似的，前端在请求后端的数据的时候，会给后端传入分页信息（比如每页的数据条数和当前页数），前端通过**监听scroll事件**持续判断是否触发了上拉加载，**每次触发上拉加载的时候，都把当前页数加一，然后请求数据**。和pc端的分页加载不同的地方就是因为手机交互的习惯，新请求的数据不会覆盖上一页的数据，也就是说**是往后追加内容，而不是替换上一页的内容**。

这里的关键是**什么时候触发上拉加载**，判断条件就是：**可视高度(offsetHeight) + 滚动距离(scrollTop) >= 实际高度(scrollHeight，表示区域内所有内容的高度（包括滚动距离）)**。而且一般监听scroll这种会频繁触发的事件，我们一般都为其添加**防抖方法**，即给一个间隔值，在间隔值内只触发一次。


参考：https://blog.csdn.net/weixin_47222576/article/details/108354249

### 2. h5中下拉刷新的原理

实现下拉刷新主要分为三步：

- 监听原生**touchstart**事件，记录其初始位置的值，e.touches[0].pageY；
- 监听原生**touchmove**事件，记录并计算当前滑动的位置值与初始位置值的差值，大于0表示向下拉动，并**借助CSS3的translateY属性**使元素跟随手势向下滑动对应的差值，同时也应设置一个允许滑动的最大值；
- 监听原生**touchend**事件，若此时元素滑动达到最大值，则触发callback（一般这个callback就是重新请求后端分页数据），同时将translateY重设为0，元素回到初始位置。

参考：https://www.cnblogs.com/zuobaiquan01/p/8874305.html
